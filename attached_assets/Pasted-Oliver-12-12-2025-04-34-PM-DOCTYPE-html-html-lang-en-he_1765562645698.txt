Oliver, [12-12-2025 04:34 PM]
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animated Spotify Jukebox Controller</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div class="ring-container">
        <i class="ring"></i>
        <i class="ring"></i>
        
        <div class="controller-box">
            <h1>Spotify Jukebox</h1>

            <p id="status-message" class="message"></p>

            <div class="input-group">
                <input type="text" id="song-input" placeholder="Song Name or Spotify URI (Queue)">
                <button id="submit-song"><i class="fas fa-plus"></i> Add to Queue</button>
            </div>

            <hr>
            
            <p class="admin-title">Admin Controls (Password 'A')</p>
            <div class="controls">
                <button id="play-pause" class="admin-control"><i class="fas fa-play"></i></button>
                <button id="next-track" class="admin-control"><i class="fas fa-forward"></i></button>
                <button id="volume-up" class="admin-control"><i class="fas fa-volume-up"></i></button>
                <button id="volume-down" class="admin-control"><i class="fas fa-volume-down"></i></button>
            </div>
            
        </div>
    </div>

    <div id="password-prompt" class="hidden">
        <input type="password" id="admin-password" placeholder="Admin Passcode">
        <button id="auth-submit">Submit</button>
    </div>

    <script src="script.js"></script>
</body>
</html>

Oliver, [12-12-2025 04:34 PM]
body {
    background-color: #121212; 
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* --- Animated Ring Styles --- */
.ring-container {
    position: relative;
    width: 350px;
    height: 350px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.ring {
    position: absolute;
    inset: 0;
    border: 5px solid #fff;
    transition: 0.5s;
    border-radius: 50%;
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
    pointer-events: none;
}

.ring:nth-child(1) {
    border-radius: 38% 62% 63% 37% / 41% 44% 56% 59%;
    animation: animate 6s linear infinite;
    border-color: #1DB954; 
    box-shadow: 0 0 20px #1DB954;
}

.ring:nth-child(2) {
    border-radius: 41% 44% 56% 59% / 38% 62% 63% 37%;
    animation: animate 4s linear infinite reverse; 
    border-color: #FF6E6E; 
    box-shadow: 0 0 20px #FF6E6E;
    transform: scale(1.05);
}

@keyframes animate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* --- Controller Box Styles --- */
.controller-box {
    position: relative;
    width: 90%;
    max-width: 300px;
    background: rgba(18, 18, 18, 0.9);
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.05);
}

h1 {
    font-size: 1.6em;
    margin-bottom: 15px;
    color: #1DB954;
}

.admin-title {
    font-size: 0.8em;
    color: #aaa;
    margin-bottom: 5px;
}

.input-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 15px;
}

input[type="text"], input[type="password"] {
    padding: 10px;
    border: 1px solid #333;
    border-radius: 8px;
    background: #282828;
    color: #fff;
    font-size: 0.9em;
    outline: none;
}

button {
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.1s;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 5px;
}

#submit-song {
    background-color: #1DB954;
    color: #000;
}
#submit-song:hover {
    background-color: #2ED86D;
}
#submit-song:active {
    transform: scale(0.98);
}

hr {
    border: 0;
    height: 1px;
    background-color: #333;
    margin: 20px 0;
}

.controls {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
}

.admin-control {
    background-color: #383838;
    color: #fff;
    width: 55px;
    height: 55px;
    font-size: 1.2em;
    padding: 0;
}
.admin-control:hover {
    background-color: #535353;
}
.admin-control:active {
    transform: scale(0.9);
}

/* Password Prompt Styling (Modal) */
#password-prompt {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #000000;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(255, 110, 110, 0.7); 
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 15px;
    border: 2px solid #FF6E6E;
}
#password-prompt.hidden {
    display: none;
}
#auth-submit {
    background-color: #FF6E6E;
    color: #000;
}
#auth-submit:hover {
    background-color: #FF8585;
}

.message {
    min-height: 18px;
    font-size: 0.9em;
    color: #1DB954;
    margin-bottom: 10px;
}

Oliver, [12-12-2025 04:34 PM]
// --- Configuration ---
const ADMIN_PASSWORD = "A"; 
let isAuthenticated = false;
let currentAction = null; 

// --- DOM Elements ---
const adminControls = document.querySelectorAll('.admin-control');
const passwordPrompt = document.getElementById('password-prompt');
const authSubmitButton = document.getElementById('auth-submit');
const adminPasswordInput = document.getElementById('admin-password');
const statusMessage = document.getElementById('status-message');

// Helper function to display status messages
function setStatus(message, isError = false) {
    statusMessage.textContent = message;
    statusMessage.style.color = isError ? '#FF6E6E' : '#1DB954';
    setTimeout(() => {
        statusMessage.textContent = '';
    }, 4000); 
}

// --- 1. Main Action Caller ---
async function callBackend(endpoint, body = {}) {
    setStatus(Sending command to Spotify...);
    try {
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(body)
        });

        const data = await response.json();
        
        if (response.ok) {
            setStatus(data.message || "Command executed successfully.");
        } else {
            setStatus(data.error || "An unknown error occurred on the server.", true);
        }
    } catch (error) {
        setStatus(Network error: Could not reach the server., true);
        console.error("Fetch Error:", error);
    }
}

// --- 2. Admin Control Handlers ---

function handleAdminAction(actionId) {
    if (actionId === 'play-pause') {
        callBackend('/api/controller', { action: 'togglePlayPause' });
    } else if (actionId === 'next-track') {
        callBackend('/api/controller', { action: 'skipNext' });
    } else if (actionId === 'volume-up' || actionId === 'volume-down') {
        promptForVolume(actionId);
    }
}

function promptForVolume(action) {
    const promptMessage = "Enter the NEW ABSOLUTE volume level (0-100):";
        
    const newVolume = prompt(promptMessage);

    if (newVolume === null || newVolume.trim() === '') return; 

    const volumeValue = parseInt(newVolume);

    if (isNaN(volumeValue)) {
        setStatus("Invalid volume input. Please enter a number between 0 and 100.", true);
        return;
    } 

    if (volumeValue >= 0 && volumeValue <= 100) {
        callBackend('/api/controller', { action: 'setVolume', volume: volumeValue });
    } else {
        setStatus("Volume must be between 0 and 100.", true);
    }
}

// --- 3. Queue Song Handler (Open to all) ---

document.getElementById('submit-song').addEventListener('click', () => {
    const songInput = document.getElementById('song-input').value;
    if (songInput.trim()) {
        callBackend('/api/controller', { action: 'addToQueue', track: songInput.trim() });
        document.getElementById('song-input').value = '';
    } else {
        setStatus("Please enter a song name or Spotify URL.", true);
    }
});


// --- 4. Password Protection Logic ---

adminControls.forEach(button => {
    button.addEventListener('click', (event) => {
        if (isAuthenticated) {
            handleAdminAction(event.currentTarget.id);
            return;
        }

        currentAction = event.currentTarget.id; 
        passwordPrompt.classList.remove('hidden');
    });
});

authSubmitButton.addEventListener('click', () => {
    const enteredPassword = adminPasswordInput.value;
    
    if (enteredPassword === ADMIN_PASSWORD) {
        isAuthenticated = true;
        passwordPrompt.classList.add('hidden');
        setStatus("Admin Access Granted! Session is active.");
        adminPasswordInput.value = ''; 

        if (currentAction) {
            setTimeout(() => {
                handleAdminAction(currentAction);
                currentAction = null;
            }, 500);
        }
    } else {
        setStatus("Incorrect Password.", true);
        adminPasswordInput.value = ''; 
        currentAction = null; 
    }
});

Oliver, [12-12-2025 04:34 PM]
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !passwordPrompt.classList.contains('hidden')) {
        passwordPrompt.classList.add('hidden');
        adminPasswordInput.value = '';
        currentAction = null;
    }
});

Oliver, [12-12-2025 04:35 PM]
// api/controller.js
// Vercel Serverless Function to handle Spotify API calls and automatic token refresh

import { MongoClient } from 'mongodb';

// --- Configuration ---
const CLIENT_ID = process.env.SPOTIFY_CLIENT_ID;
const CLIENT_SECRET = process.env.SPOTIFY_CLIENT_SECRET;
const MONGODB_URI = process.env.MONGODB_URI; // Your Atlas Connection String

const TOKEN_STORAGE_KEY = 'spotify_auth_tokens';
const DB_NAME = 'spotify_controller_db';

let cachedDb = null;
let CURRENT_ACCESS_TOKEN = null;
let TOKEN_EXPIRY_TIME = 0;

// --- Database Connection ---

async function connectToDatabase() {
    if (cachedDb) return cachedDb;

    if (!MONGODB_URI) throw new Error("MONGODB_URI environment variable is not set.");
    
    const client = await MongoClient.connect(MONGODB_URI);
    const db = client.db(DB_NAME);
    cachedDb = db;
    return db;
}

// --- Token Persistence Functions ---

async function getStoredTokens(db) {
    const tokens = await db.collection('tokens').findOne({ _id: TOKEN_STORAGE_KEY });
    return tokens;
}

async function saveNewTokens(db, accessToken, refreshToken) {
    const update = {
        $set: {
            access_token: accessToken,
            refresh_token: refreshToken,
            last_updated: new Date()
        }
    };
    await db.collection('tokens').updateOne(
        { _id: TOKEN_STORAGE_KEY },
        update,
        { upsert: true } // Creates the document if it doesn't exist
    );
}

// --- Token Refresh Logic (Automatic) ---

async function getValidAccessToken(db) {
    const now = Date.now();
    // 1. Check current Access Token validity (5 minute buffer)
    if (CURRENT_ACCESS_TOKEN && now < TOKEN_EXPIRY_TIME - (5 * 60 * 1000)) {
        return CURRENT_ACCESS_TOKEN;
    }
    
    // 2. Access Token expired/missing: Fetch Refresh Token from DB
    const storedTokens = await getStoredTokens(db);
    const refreshToken = storedTokens?.refresh_token;

    if (!refreshToken) {
        throw new Error("No Spotify Refresh Token found in the database. Please perform initial OAuth setup.");
    }
    
    // 3. Request new tokens from Spotify
    const authString = Buffer.from(${CLIENT_ID}:${CLIENT_SECRET}).toString('base64');
    
    const response = await fetch('https://accounts.spotify.com/api/token', {
        method: 'POST',
        headers: {
            'Authorization': Basic ${authString},
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: new URLSearchParams({
            grant_type: 'refresh_token',
            refresh_token: refreshToken
        })
    });

    const data = await response.json();
    
    if (data.access_token) {
        // Update variables for this function execution
        CURRENT_ACCESS_TOKEN = data.access_token;
        TOKEN_EXPIRY_TIME = now + (data.expires_in * 1000); 
        
        // 4. AUTOMATIC PERSISTENCE: Save the new Refresh Token if one was provided (rotation)
        const newRefreshToken = data.refresh_token || refreshToken;
        await saveNewTokens(db, CURRENT_ACCESS_TOKEN, newRefreshToken);

        return CURRENT_ACCESS_TOKEN;

    } else {
        throw new Error(Token Refresh Failed: ${data.error_description || JSON.stringify(data)});
    }
}

// --- Spotify API Interaction Functions ---

const SPOTIFY_API_BASE = 'https://api.spotify.com/v1/me/player/pause'; 

async function spotifyApiCall(method, endpoint, accessToken, body = null) {
    const options = {
        method: method,
        headers: {
            'Authorization': Bearer ${accessToken},
            'Content-Type': 'application/json',
        },
    };
    if (body) options.body = JSON.stringify(body);
    
    const response = await fetch(SPOTIFY_API_BASE + endpoint, options);

    if (response.status === 204 || response.ok) {
        return response;
    } else {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(Spotify API Error (${response.status}): ${errorData.error?.message || 'Unknown error'});
    }
}

// --- Main Vercel Handler ---

Oliver, [12-12-2025 04:35 PM]
export default async function handler(req, res) {
    if (req.method !== 'POST') {
        return res.status(405).json({ error: 'Method Not Allowed' });
    }

    const { action, track, volume } = req.body;
    let db;

    try {
        db = await connectToDatabase();
        const accessToken = await getValidAccessToken(db);
        
        switch (action) {
            case 'togglePlayPause':
                // Attempt to resume playback on the last active device
                await spotifyApiCall('PUT', /me/player/play, accessToken);
                return res.status(200).json({ message: 'Playback command sent (resumed or started).' });

            case 'skipNext':
                await spotifyApiCall('POST', /me/player/next, accessToken);
                return res.status(200).json({ message: 'Skipped to the next track.' });

            case 'setVolume':
                const targetVolume = Math.min(100, Math.max(0, parseInt(volume)));
                if (isNaN(targetVolume)) throw new Error("Invalid volume value.");
                await spotifyApiCall('PUT', /me/player/volume?volume_percent=${targetVolume}, accessToken);
                return res.status(200).json({ message: Volume set to ${targetVolume}%. });

            case 'addToQueue':
                // 1. Search for the track
                const searchResponse = await spotifyApiCall('GET', /search?q=${encodeURIComponent(track)}&type=track&limit=1, accessToken);
                const searchData = await searchResponse.json();
                const trackUri = searchData.tracks?.items?.[0]?.uri;

                if (!trackUri) {
                    throw new Error(Could not find a Spotify track for: ${track});
                }

                // 2. Add the track to the queue
                await spotifyApiCall('POST', /me/player/queue?uri=${trackUri}, accessToken);
                return res.status(200).json({ message: Added "${searchData.tracks.items[0].name}" to the queue. });

            default:
                return res.status(400).json({ error: 'Invalid action specified.' });
        }

    } catch (error) {
        console.error("Handler Error:", error.message);
        return res.status(500).json({ error: error.message || 'Server failed to process the request.' });
    }
}

Oliver, [12-12-2025 04:35 PM]
// api/controller.js
// Vercel Serverless Function to handle Spotify API calls and automatic token refresh

import { MongoClient } from 'mongodb';

// --- Configuration ---
const CLIENT_ID = process.env.SPOTIFY_CLIENT_ID;
const CLIENT_SECRET = process.env.SPOTIFY_CLIENT_SECRET;
const MONGODB_URI = process.env.MONGODB_URI; // Your Atlas Connection String

const TOKEN_STORAGE_KEY = 'spotify_auth_tokens';
const DB_NAME = 'spotify_controller_db';

let cachedDb = null;
let CURRENT_ACCESS_TOKEN = null;
let TOKEN_EXPIRY_TIME = 0;

// --- Database Connection ---

async function connectToDatabase() {
    if (cachedDb) return cachedDb;

    if (!MONGODB_URI) throw new Error("MONGODB_URI environment variable is not set.");
    
    const client = await MongoClient.connect(MONGODB_URI);
    const db = client.db(DB_NAME);
    cachedDb = db;
    return db;
}

// --- Token Persistence Functions ---

async function getStoredTokens(db) {
    const tokens = await db.collection('tokens').findOne({ _id: TOKEN_STORAGE_KEY });
    return tokens;
}

async function saveNewTokens(db, accessToken, refreshToken) {
    const update = {
        $set: {
            access_token: accessToken,
            refresh_token: refreshToken,
            last_updated: new Date()
        }
    };
    await db.collection('tokens').updateOne(
        { _id: TOKEN_STORAGE_KEY },
        update,
        { upsert: true } // Creates the document if it doesn't exist
    );
}

// --- Token Refresh Logic (Automatic) ---

async function getValidAccessToken(db) {
    const now = Date.now();
    // 1. Check current Access Token validity (5 minute buffer)
    if (CURRENT_ACCESS_TOKEN && now < TOKEN_EXPIRY_TIME - (5 * 60 * 1000)) {
        return CURRENT_ACCESS_TOKEN;
    }
    
    // 2. Access Token expired/missing: Fetch Refresh Token from DB
    const storedTokens = await getStoredTokens(db);
    const refreshToken = storedTokens?.refresh_token;

    if (!refreshToken) {
        throw new Error("No Spotify Refresh Token found in the database. Please perform initial OAuth setup.");
    }
    
    // 3. Request new tokens from Spotify
    const authString = Buffer.from(${CLIENT_ID}:${CLIENT_SECRET}).toString('base64');
    
    const response = await fetch('https://accounts.spotify.com/api/token', {
        method: 'POST',
        headers: {
            'Authorization': Basic ${authString},
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: new URLSearchParams({
            grant_type: 'refresh_token',
            refresh_token: refreshToken
        })
    });

    const data = await response.json();
    
    if (data.access_token) {
        // Update variables for this function execution
        CURRENT_ACCESS_TOKEN = data.access_token;
        TOKEN_EXPIRY_TIME = now + (data.expires_in * 1000); 
        
        // 4. AUTOMATIC PERSISTENCE: Save the new Refresh Token if one was provided (rotation)
        const newRefreshToken = data.refresh_token || refreshToken;
        await saveNewTokens(db, CURRENT_ACCESS_TOKEN, newRefreshToken);

        return CURRENT_ACCESS_TOKEN;

    } else {
        throw new Error(Token Refresh Failed: ${data.error_description || JSON.stringify(data)});
    }
}

// --- Spotify API Interaction Functions ---

const SPOTIFY_API_BASE = 'https://api.spotify.com/v1/me/player/pause'; 

async function spotifyApiCall(method, endpoint, accessToken, body = null) {
    const options = {
        method: method,
        headers: {
            'Authorization': Bearer ${accessToken},
            'Content-Type': 'application/json',
        },
    };
    if (body) options.body = JSON.stringify(body);
    
    const response = await fetch(SPOTIFY_API_BASE + endpoint, options);

    if (response.status === 204 || response.ok) {
        return response;
    } else {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(Spotify API Error (${response.status}): ${errorData.error?.message || 'Unknown error'});
    }
}

// --- Main Vercel Handler ---

Oliver, [12-12-2025 04:35 PM]
export default async function handler(req, res) {
    if (req.method !== 'POST') {
        return res.status(405).json({ error: 'Method Not Allowed' });
    }

    const { action, track, volume } = req.body;
    let db;

    try {
        db = await connectToDatabase();
        const accessToken = await getValidAccessToken(db);
        
        switch (action) {
            case 'togglePlayPause':
                // Attempt to resume playback on the last active device
                await spotifyApiCall('PUT', /me/player/play, accessToken);
                return res.status(200).json({ message: 'Playback command sent (resumed or started).' });

            case 'skipNext':
                await spotifyApiCall('POST', /me/player/next, accessToken);
                return res.status(200).json({ message: 'Skipped to the next track.' });

            case 'setVolume':
                const targetVolume = Math.min(100, Math.max(0, parseInt(volume)));
                if (isNaN(targetVolume)) throw new Error("Invalid volume value.");
                await spotifyApiCall('PUT', /me/player/volume?volume_percent=${targetVolume}, accessToken);
                return res.status(200).json({ message: Volume set to ${targetVolume}%. });

            case 'addToQueue':
                // 1. Search for the track
                const searchResponse = await spotifyApiCall('GET', /search?q=${encodeURIComponent(track)}&type=track&limit=1, accessToken);
                const searchData = await searchResponse.json();
                const trackUri = searchData.tracks?.items?.[0]?.uri;

                if (!trackUri) {
                    throw new Error(Could not find a Spotify track for: ${track});
                }

                // 2. Add the track to the queue
                await spotifyApiCall('POST', /me/player/queue?uri=${trackUri}, accessToken);
                return res.status(200).json({ message: Added "${searchData.tracks.items[0].name}" to the queue. });

            default:
                return res.status(400).json({ error: 'Invalid action specified.' });
        }

    } catch (error) {
        console.error("Handler Error:", error.message);
        return res.status(500).json({ error: error.message || 'Server failed to process the request.' });
    }
}